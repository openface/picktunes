<div class="container" style="margin-top:5%" id="content"></div>

<script id="mobileTemplate" type="text/html">
	<div class="mobile-prompt">
		<i class="material-icons large">music_note</i>
		<h5>Ready to Play?</h5>
		<p>Tap below to start the music!</p>
		<button class="btn-large waves-effect waves-light purple" id="startMusic">
			<i class="material-icons left">play_arrow</i>Start The Music
		</button>
	</div>
</script>

<script id="pleaseWaitTemplate" type="text/x-jquery-tmpl">
  <div class="loading-screen">
    <div class="preloader-wrapper big active">
      <div class="spinner-layer spinner-purple-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
    <p class="loading-text">Loading your songs...</p>
  </div>
</script>

<script id="gameTemplate" type="text/html">
  <div class="game-header">
    <div class="game-stats">
      <div class="stat-card">
        <span class="stat-label">Round</span>
        <span class="stat-value" id="round">1</span>
      </div>
      <div class="stat-card timer-card">
        <span class="stat-label">Time Left</span>
        <div class="timer-visual">
          <svg class="timer-circle" viewBox="0 0 100 100">
            <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
            <circle class="timer-circle-progress" id="timerProgress" cx="50" cy="50" r="45"></circle>
          </svg>
          <span id="counter" class="timer-value-inside">20</span>
        </div>
      </div>
      <div class="stat-card score-card">
        <span class="stat-label">Score</span>
        <span class="stat-value" id="score">0</span>
      </div>
    </div>
  </div>
  <div class="songs-container">
    <div id="songsList"></div>
  </div>
</script>

<script id="songsTemplate" type="text/x-jquery-tmpl">
  <div class="song-card" data-id="${id}">
    <div class="song-image">
      <img src="${image}" alt="">
    </div>
    <div class="song-info">
      <div class="song-name">${name}</div>
      <div class="song-artist">${artist}</div>
    </div>
  </div>
</script>

<script id="rightAnswerTemplate" type="text/x-jquery-tmpl">
  <div class="center-align">
    <img src="/images/right.png" />
  </div>
</script>

<script id="wrongAnswerTemplate" type="text/x-jquery-tmpl">
  <div class="center-align">
    <img src="/images/wrong.png" />
  </div>
</script>

<script>
$("#content").html($("#pleaseWaitTemplate").tmpl());
$(document).on(
	'fbload',
	function() {
		$.get("/songs.json")
			.done(function(data) {
				Game.setSongs(data);

				// Safari requires user interaction before audio can play
				var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
				
				if (isMobile.any() || isSafari) {
					$("#content").html($("#mobileTemplate").tmpl());
					$("#startMusic").click(function() {
						$("#content").html($("#gameTemplate").tmpl())
						Game.startRound();
					});
				} else {
					$("#content").html($("#gameTemplate").tmpl());
					Game.startRound();
				}
			})
			.fail(function(xhr, status, error) {
				console.error('Failed to load songs:', error);
				console.error('Response:', xhr.responseJSON);
				var errorMsg = 'Failed to load songs. Please refresh the page.';
				if (xhr.responseJSON && xhr.responseJSON.error) {
					errorMsg = xhr.responseJSON.error;
				}
				$("#content").html('<div class="row"><div class="col s12 center-align"><p class="flow-text red-text">' + errorMsg + '</p><a href="/" class="btn">Go Back</a></div></div>');
			});
	}
);
</script>
