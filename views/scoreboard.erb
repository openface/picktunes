<div class="scoreboard-page">
  <% if @last_game %>
    <div class="game-over-banner">
      <div class="container">
        <div class="game-over-content">
          <h2 class="game-over-title">ðŸŽ‰ Game Over!</h2>
          <div class="final-score">
            <span class="score-label">You Scored</span>
            <span class="score-value"><%=@last_game.score%></span>
            <span class="score-genre"><%=settings.genres[@last_game.genre]%> Points</span>
          </div>
          <div class="game-over-actions">
            <a href="javascript:shareScoreToFacebook('I scored <%=@last_game.score%> <%=settings.genres[@last_game.genre].downcase%> points on picktun.es!');" class="btn-flat waves-effect white-text">
              <i class="material-icons left">share</i>Share on Facebook
            </a>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="scoreboard-header">
    <div class="container">
      <div class="header-content">
        <div class="header-left">
          <h4 class="scoreboard-title">
            <i class="material-icons">emoji_events</i>
            Top Players
          </h4>
          <span class="timeframe-badge" id="timeframe">Latest</span>
        </div>
        <div class="header-right">
          <a class="btn waves-effect waves-light purple" href="/">
            <i class="material-icons left">play_arrow</i>Play Again
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="tabs-container">
    <div class="container">
      <div class="tabs-wrapper">
        <ul class="tabs">
          <li class="tab"><a class="active" href="#latest">Latest</a></li>
          <li class="tab"><a href="#all_time">All Time</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container scoreboard-content">
    <div class="scores" id="latest"></div>
    <div class="scores" id="all_time"></div>
  </div>
</div>

<script id="scoresListTemplate" type="text/x-jquery-tmpl">
  <div class="row">
    {{each(genre,games) scores}}
      <div class="col s12 m6 l4">
        <div class="scoreboard-genre-card" data-genre="${genre}">
          <div class="scoreboard-genre-header">
            <h5>${genre}</h5>
          </div>
          <div class="scoreboard-table-wrapper">
            <div class="score-list">
              {{each games}}
                <div class="score-item ${last_game_id == id ? 'highlight-row' : ''}">
                  <span class="score-rank"><strong>${index}</strong></span>
                  <span class="score-name">${username}</span>
                  <span class="score-points"><strong>${score}</strong></span>
                  <span class="score-date">${created_at}</span>
                </div>
              {{/each}}
            </div>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
</script>


<script>
$(document).ready(function() {

	$.get("/scores.json?filter=latest")
		.done(function(data) {
			$("#latest").html($("#scoresListTemplate").tmpl({
				scores: data,
				last_game_id: <%=@last_game ? @last_game.id : 'null'%>
			}));
		})
		.fail(function() {
			$("#latest").html('<div class="col s12 center-align"><p class="red-text">Failed to load scores.</p></div>');
		});

	$.get("/scores.json?filter=all_time")
		.done(function(data) {
			$("#all_time").html($("#scoresListTemplate").tmpl({
				scores: data,
				last_game_id: <%=@last_game ? @last_game.id : 'null'%>
			}));
		})
		.fail(function() {
			$("#all_time").html('<div class="col s12 center-align"><p class="red-text">Failed to load scores.</p></div>');
		});

	var tabs = M.Tabs.init(document.querySelector('.tabs'), {
		onShow: function(el) {
			if (el.id == 'all_time') {
				$('#timeframe').html('All Time');
			} else {
				$('#timeframe').html('Latest');
			}
		}
	});
});
</script>
